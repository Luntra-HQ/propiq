# Render.com Configuration for PropIQ Backend
# This file enables one-click deployment to Render.com

services:
  - type: web
    name: propiq-backend
    runtime: python
    env: python
    region: oregon  # Choose closest to your users
    plan: free  # Start with free tier, upgrade to "starter" ($7/mo) for always-on
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn api:app --host 0.0.0.0 --port $PORT

    envVars:
      # Azure OpenAI (REQUIRED)
      - key: AZURE_OPENAI_ENDPOINT
        sync: false  # Set manually in Render dashboard
      - key: AZURE_OPENAI_KEY
        sync: false
      - key: AZURE_OPENAI_API_VERSION
        value: 2025-01-01-preview
      - key: AZURE_OPENAI_DEPLOYMENT
        value: gpt-4o-mini

      # MongoDB (REQUIRED)
      - key: MONGODB_URI
        sync: false  # Set manually in Render dashboard

      # JWT Authentication (REQUIRED)
      - key: JWT_SECRET
        sync: false

      # Stripe (REQUIRED - for payments with bdusape@luntra.one account)
      - key: STRIPE_SECRET_KEY
        sync: false  # Set in Render dashboard
      - key: STRIPE_PUBLISHABLE_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: STRIPE_PRICE_ID
        sync: false  # Default: Pro tier
      - key: STRIPE_PRICE_STARTER
        sync: false
      - key: STRIPE_PRICE_PRO
        sync: false
      - key: STRIPE_PRICE_ELITE
        sync: false

      # Weights & Biases (Optional - for analytics)
      - key: WANDB_API_KEY
        sync: false
      - key: WANDB_MODE
        value: online

      # SendGrid (REQUIRED - for email marketing)
      - key: SENDGRID_API_KEY
        sync: false
      - key: FROM_EMAIL
        value: contact@luntra.one
      - key: SUPPORT_EMAIL
        value: contact@luntra.one

      # Slack (REQUIRED - for payment notifications)
      - key: SLACK_WEBHOOK_URL
        sync: false

      # Intercom (Optional - customer messaging)
      - key: INTERCOM_ACCESS_TOKEN
        sync: false
      - key: INTERCOM_API_KEY
        sync: false

      # CORS Origins (production only - no localhost)
      - key: ALLOWED_ORIGINS
        value: https://luntra.one,https://propiq.luntra.one

      # App URL
      - key: APP_URL
        value: https://propiq.luntra.one

      # Environment
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "False"

      # Python version
      - key: PYTHON_VERSION
        value: "3.11"

    # Health check endpoint
    healthCheckPath: /health

    # Auto-deploy on push to main branch
    autoDeploy: true
